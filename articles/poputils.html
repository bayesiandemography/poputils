<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>poputils • poputils</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="poputils">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">poputils</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/poputils.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bayesiandemography/poputils/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>poputils</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bayesiandemography/poputils/blob/main/vignettes/poputils.Rmd" class="external-link"><code>vignettes/poputils.Rmd</code></a></small>
      <div class="d-none name"><code>poputils.Rmd</code></div>
    </div>

    
    
<div class="section level2" number="1">
<h2 id="aims">
<span class="header-section-number">1</span> Aims<a class="anchor" aria-label="anchor" href="#aims"></a>
</h2>
<p><strong>poputils</strong> contains tools for carrying out common tasks when working with demographic data. Some distinctive features:</p>
<ul>
<li>
<strong>poputils</strong> tries to into <a href="https://www.tidyverse.org" class="external-link">tidyverse</a> workflows. For instance, <strong>poputils</strong> functions use data frames for inputs and outputs, use <a href="https://tidyselect.r-lib.org/reference/language.html" class="external-link">tidyselect</a> methods to specify variables, and follow tidyverse conventions for variable names.</li>
<li>
<strong>poputils</strong> allows for uncertainty through the use of <a href="https://bayesiandemography.github.io/rvec/reference/rvec.html" class="external-link">rvecs</a>. An rvec is an object holding multiple draws from a distribution that behaves similarly to an ordinary R vector.</li>
<li>Allow users to work directly with age and time labels, based on common set of methods.</li>
</ul>
<p>Some functions in <strong>poputils</strong> are designed for data analysts working on demographic datasets. Others are designed for programmers creating functions to be used at data analysts.</p>
</div>
<div class="section level2" number="2">
<h2 id="tools-for-data-analysts">
<span class="header-section-number">2</span> Tools for data analysts<a class="anchor" aria-label="anchor" href="#tools-for-data-analysts"></a>
</h2>
<div class="section level3" number="2.1">
<h3 id="labels">
<span class="header-section-number">2.1</span> Labels<a class="anchor" aria-label="anchor" href="#labels"></a>
</h3>
<div class="section level4" number="2.1.1">
<h4 id="age">
<span class="header-section-number">2.1.1</span> Age<a class="anchor" aria-label="anchor" href="#age"></a>
</h4>
<p>Producers of demographic data follow a wide variety of styles for labeling age groups. <strong>poputils</strong> contains tools for parsing and manipulating age group labels.</p>
<p>Age label functions in <strong>poputils</strong> require that age labels belong to one of three types:</p>
<ul>
<li>
<code>"single"</code>. Single years of age, possibly including an open age group, eg <code>"0",</code>“81”<code>,</code>“17”<code>,</code>“100+”`.</li>
<li>
<code>"five"</code>. Five-year age groups, possibly including an open age group, eg <code>"0-4"</code>, <code>"80-84"</code>, <code>"15-19"</code>, <code>"100+"</code>.</li>
<li>
<code>"lt"</code>. Life table age groups. Like <code>"five"</code>, but with the <code>"0-4"</code> age group split into <code>"0"</code> and <code>"1-4"</code>.</li>
</ul>
<p>Age labels created by <strong>poputils</strong> functions such as <code><a href="../reference/age_labels.html">age_labels()</a></code> follow a standard set of rules. Many age labels created using other rules can, however, be parsed by <strong>poputils</strong> functions,</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayesiandemography.github.io/poputils/">poputils</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>original <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"5 to 9"</span>, <span class="st">"5_9"</span>, <span class="st">"05-09"</span><span class="op">)</span>,</span>
<span>       reformated <span class="op">=</span> <span class="fu"><a href="../reference/reformat_age.html">reformat_age</a></span><span class="op">(</span><span class="va">original</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;   original reformated</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 5 to 9   5-9       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 5_9      5-9       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 05-09    5-9</span></span></code></pre></div>
<p>Functions <code><a href="../reference/age_lower.html">age_lower()</a></code>, <code><a href="../reference/age_lower.html">age_upper()</a></code>, and <code><a href="../reference/age_lower.html">age_mid()</a></code> extract information about lower limits, upper limits, and centers of age groups. This can be useful for ordering data</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"5-9"</span>, <span class="st">"0-4"</span>, <span class="st">"15-19"</span>, <span class="st">"10-14"</span><span class="op">)</span>,</span>
<span>                 population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">7</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt;     age population</span></span>
<span><span class="co">#&gt; 1   5-9          3</span></span>
<span><span class="co">#&gt; 2   0-4          7</span></span>
<span><span class="co">#&gt; 3 15-19          2</span></span>
<span><span class="co">#&gt; 4 10-14          4</span></span>
<span><span class="va">df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="../reference/age_lower.html">age_lower</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;     age population</span></span>
<span><span class="co">#&gt; 1   0-4          7</span></span>
<span><span class="co">#&gt; 2   5-9          3</span></span>
<span><span class="co">#&gt; 3 10-14          4</span></span>
<span><span class="co">#&gt; 4 15-19          2</span></span></code></pre></div>
<p>and plotting</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="../reference/age_lower.html">age_mid</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">population</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="poputils_files/figure-html/unnamed-chunk-4-1.png"><!-- --></p>
<p>among other things.</p>
<p>Functions <code><a href="../reference/combine_age.html">combine_age()</a></code> and <code><a href="../reference/set_age_open.html">set_age_open()</a></code> can be used to collapse age groups,</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="../reference/age_labels.html">age_labels</a></span><span class="op">(</span><span class="st">"lt"</span>, max <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>       age_5 <span class="op">=</span> <span class="fu"><a href="../reference/combine_age.html">combine_age</a></span><span class="op">(</span><span class="va">age</span>, to <span class="op">=</span> <span class="st">"five"</span><span class="op">)</span>,</span>
<span>       age_25plus <span class="op">=</span> <span class="fu"><a href="../reference/set_age_open.html">set_age_open</a></span><span class="op">(</span><span class="va">age</span>, lower <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 3</span></span></span>
<span><span class="co">#&gt;   age   age_5 age_25plus</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0     0-4   0         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1-4   0-4   1-4       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 5-9   5-9   5-9       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 10-14 10-14 10-14     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 15-19 15-19 15-19     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 20-24 20-24 20+       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 25-29 25-29 20+       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> 30+   30+   20+</span></span></code></pre></div>
<p>The aim is that users should be able to with age group labels throughout the analysis.</p>
</div>
<div class="section level4" number="2.1.2">
<h4 id="sexgender">
<span class="header-section-number">2.1.2</span> Sex/gender<a class="anchor" aria-label="anchor" href="#sexgender"></a>
</h4>
<p>Function <code><a href="../reference/reformat_sex.html">reformat_sex()</a></code> converts sex/gender categories to <code>"Female"</code>, <code>"Male"</code>, and any additional categories specified through the <code>except</code> argument,</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/reformat_sex.html">reformat_sex</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"Diverse"</span>, <span class="st">"Fem"</span><span class="op">)</span>, except <span class="op">=</span> <span class="st">"Diverse"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] Male    Female  Diverse Female </span></span>
<span><span class="co">#&gt; Levels: Female Male Diverse</span></span></code></pre></div>
</div>
</div>
<div class="section level3" number="2.2">
<h3 id="life-tables-and-life-expectancy">
<span class="header-section-number">2.2</span> Life tables and life expectancy<a class="anchor" aria-label="anchor" href="#life-tables-and-life-expectancy"></a>
</h3>
<p>A life table a way of summarizing mortality conditions. It consists of quantities calculated from age-specific mortality rates. The most widely-used life table quantity is life expectancy at birth.</p>
<div class="section level4" number="2.2.1">
<h4 id="basic-functionality">
<span class="header-section-number">2.2.1</span> Basic functionality<a class="anchor" aria-label="anchor" href="#basic-functionality"></a>
</h4>
<p>Life tables can be calculated from age-specific mortality rates using function <code><a href="../reference/lifetab.html">lifetab()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nzmort</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2022</span>,</span>
<span>         <span class="va">gender</span> <span class="op">==</span> <span class="st">"Female"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lifetab.html">lifetab</a></span><span class="op">(</span>mx <span class="op">=</span> <span class="va">mx</span><span class="op">)</span>  </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 21 × 10</span></span></span>
<span><span class="co">#&gt;     year gender age         deaths   popn       qx      lx    dx      Lx    ex</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">2</span>022 Female Infant          84  <span style="text-decoration: underline;">29</span>680 0.002<span style="text-decoration: underline;">83</span>  <span style="text-decoration: underline;">100</span>000  283.   <span style="text-decoration: underline;">99</span>859.  83.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">2</span>022 Female 1-4 years       18 <span style="text-decoration: underline;">118</span>420 0.000<span style="text-decoration: underline;">608</span>  <span style="text-decoration: underline;">99</span>717.  60.6 <span style="text-decoration: underline;">398</span>748.  82.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">2</span>022 Female 5-9 years       12 <span style="text-decoration: underline;">156</span>820 0.000<span style="text-decoration: underline;">383</span>  <span style="text-decoration: underline;">99</span>657.  38.1 <span style="text-decoration: underline;">498</span>189.  78.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">2</span>022 Female 10-14 years     15 <span style="text-decoration: underline;">164</span>830 0.000<span style="text-decoration: underline;">455</span>  <span style="text-decoration: underline;">99</span>619.  45.3 <span style="text-decoration: underline;">497</span>980.  73.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>022 Female 15-19 years     42 <span style="text-decoration: underline;">154</span>150 0.001<span style="text-decoration: underline;">36</span>   <span style="text-decoration: underline;">99</span>573. 136.  <span style="text-decoration: underline;">497</span>528.  68.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>022 Female 20-24 years     63 <span style="text-decoration: underline;">156</span>860 0.002<span style="text-decoration: underline;">01</span>   <span style="text-decoration: underline;">99</span>438. 199.  <span style="text-decoration: underline;">496</span>690.  63.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>022 Female 25-29 years     72 <span style="text-decoration: underline;">172</span>770 0.002<span style="text-decoration: underline;">08</span>   <span style="text-decoration: underline;">99</span>238. 207.  <span style="text-decoration: underline;">495</span>675.  59.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>022 Female 30-34 years     78 <span style="text-decoration: underline;">194</span>570 0.002<span style="text-decoration: underline;">00</span>   <span style="text-decoration: underline;">99</span>032. 198.  <span style="text-decoration: underline;">494</span>663.  54.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>022 Female 35-39 years    111 <span style="text-decoration: underline;">175</span>050 0.003<span style="text-decoration: underline;">17</span>   <span style="text-decoration: underline;">98</span>833. 313.  <span style="text-decoration: underline;">493</span>385.  49.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>022 Female 40-44 years    147 <span style="text-decoration: underline;">160</span>070 0.004<span style="text-decoration: underline;">58</span>   <span style="text-decoration: underline;">98</span>521. 451.  <span style="text-decoration: underline;">491</span>474.  44.3</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 11 more rows</span></span></span></code></pre></div>
<p><code><a href="../reference/lifetab.html">lifetab()</a></code> and <code><a href="../reference/lifetab.html">lifeexp()</a></code> both have a <code>by</code> argument. Separate results are calculated for each combination of the <code>by</code> variables,</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nzmort</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lifetab.html">lifeexp</a></span><span class="op">(</span>mx <span class="op">=</span> <span class="va">mx</span>,</span>
<span>          by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">gender</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span>  </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   gender  year    ex</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Female  <span style="text-decoration: underline;">2</span>021  84.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Male    <span style="text-decoration: underline;">2</span>021  80.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Female  <span style="text-decoration: underline;">2</span>022  83.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Male    <span style="text-decoration: underline;">2</span>022  80.0</span></span></code></pre></div>
<p>The same effect can be obtained using <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">dplyr::group_by()</a></code>,</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nzmort</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">gender</span>, <span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lifetab.html">lifeexp</a></span><span class="op">(</span>mx <span class="op">=</span> <span class="va">mx</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   gender  year    ex</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Female  <span style="text-decoration: underline;">2</span>021  84.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Male    <span style="text-decoration: underline;">2</span>021  80.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Female  <span style="text-decoration: underline;">2</span>022  83.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Male    <span style="text-decoration: underline;">2</span>022  80.0</span></span></code></pre></div>
<p>The input data for life tables and life expectancies can be probabilities of dying (<code>qx</code>), rather than mortality rates (<code>mx</code>)</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">west_lifetab</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">level</span>, <span class="va">sex</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lifetab.html">lifeexp</a></span><span class="op">(</span>qx <span class="op">=</span> <span class="va">qx</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 50 × 3</span></span></span>
<span><span class="co">#&gt;    level sex       ex</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 Female  20.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     1 Male    18.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     2 Female  22.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     2 Male    20.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     3 Female  25.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     3 Male    22.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     4 Female  27.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     4 Male    25.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     5 Female  30.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     5 Male    27.7</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 40 more rows</span></span></span></code></pre></div>
<p>By default, <code><a href="../reference/lifetab.html">lifeexp()</a></code> calculates life expectancy at age zero. It can, however, be used to calculate life expectancy at other ages.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nzmort</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lifetab.html">lifeexp</a></span><span class="op">(</span>mx <span class="op">=</span> <span class="va">mx</span>,</span>
<span>          at <span class="op">=</span> <span class="fl">65</span>,</span>
<span>          by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">gender</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span>  </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   gender  year    ex</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Female  <span style="text-decoration: underline;">2</span>021  22.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Male    <span style="text-decoration: underline;">2</span>021  19.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Female  <span style="text-decoration: underline;">2</span>022  21.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Male    <span style="text-decoration: underline;">2</span>022  19.3</span></span></code></pre></div>
</div>
<div class="section level4" number="2.2.2">
<h4 id="calculation-methods">
<span class="header-section-number">2.2.2</span> Calculation methods<a class="anchor" aria-label="anchor" href="#calculation-methods"></a>
</h4>
<p>Alternative methods for calculating life tables differ mainly in their assumptions variation within age groups <span class="citation">(Preston, Heuveline, and Guillot 2001; Keyfitz and Caswell 2005)</span>. It turns out that, for the purposes of constructing life tables, all the relevant information about the way that mortality varies by age within each age group can be captured by a single number: the average length of time lived in an interval by people who die in that interval <span class="citation">(Preston, Heuveline, and Guillot 2001, 43)</span>. This number is denoted <span class="math inline">\(_na_x\)</span>, where <span class="math inline">\(x\)</span> is exact age at the start of the internal, and <span class="math inline">\(n\)</span> is the length of the interval. The quantity <span class="math inline">\(_5a_{20}\)</span>, for instance, refers to the average number of years lived after their 20th birthday by people who die between their 20th and 25th birthdays. When <span class="math inline">\(n=1\)</span>, the <span class="math inline">\(n\)</span> subscript is typically omitted.</p>
<p>Functions <code><a href="../reference/lifetab.html">lifetab()</a></code> and <code><a href="../reference/lifetab.html">lifeexp()</a></code> have four arguments for specifying calculation methods:</p>
<ul>
<li>
<code>infant</code>, which specifies how <span class="math inline">\(a_0\)</span> is calculated,</li>
<li>
<code>child</code>, which specifies how <span class="math inline">\(_4a_1\)</span> is calculated,</li>
<li>
<code>closed</code>, which specifies how <span class="math inline">\(_na_x\)</span> for all other closed intervals are calculated, and</li>
<li>
<code>open</code>, which specifies how the final interval, <span class="math inline">\(_{\infty}a_x\)</span> is calculated.</li>
</ul>
<p>Different choices of method are available for each argument. In some cases, different formulas are used for females and males. The formulas can also differ depending on whether the input data is of mortality rates or probabilities of dying.</p>
<table class="table">
<colgroup>
<col width="8%">
<col width="8%">
<col width="14%">
<col width="7%">
<col width="62%">
</colgroup>
<thead><tr class="header">
<th align="left"><code>argument</code></th>
<th align="left"><code>sex</code></th>
<th align="left"><code>method</code></th>
<th align="center">input</th>
<th align="center">formula</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>infant</code></td>
<td align="left">&lt;any&gt;</td>
<td align="left"><code>"constant"</code></td>
<td align="center"><code>mx</code></td>
<td align="center"><span class="math display">\[a_0 = \frac{1 - (m_0 + 1) e^{-m_0}}{m_0 (1 - e^{-m_0})}\]</span></td>
</tr>
<tr class="even">
<td align="left"><code>infant</code></td>
<td align="left">&lt;any&gt;</td>
<td align="left"><code>"constant"</code></td>
<td align="center"><code>qx</code></td>
<td align="center"><span class="math display">\[a_0 = \frac{(1 - \log(1 - q_0) (1 - q_0)) - 1}{\log(1 - q_0) q_0}\]</span></td>
</tr>
<tr class="odd">
<td align="left"><code>infant</code></td>
<td align="left">&lt;any&gt;</td>
<td align="left"><code>"linear"</code></td>
<td align="center"><code>mx</code></td>
<td align="center"><span class="math display">\[a_0 = 0.5\]</span></td>
</tr>
<tr class="even">
<td align="left"><code>infant</code></td>
<td align="left">&lt;any&gt;</td>
<td align="left"><code>"linear"</code></td>
<td align="center"><code>qx</code></td>
<td align="center"><span class="math display">\[a_0 = 0.5\]</span></td>
</tr>
<tr class="odd">
<td align="left"><code>infant</code></td>
<td align="left">Female</td>
<td align="left"><code>"CD"</code></td>
<td align="center"><code>mx</code></td>
<td align="center"><span class="math display">\[a_0 = \begin{cases} 0.053 + 2.8 m_0 &amp; 0 \le m_0 &lt; 0.107 \\ 0.35 &amp;  m_0 \ge 0.107 \end{cases}\]</span></td>
</tr>
<tr class="even">
<td align="left"><code>infant</code></td>
<td align="left">Female</td>
<td align="left"><code>"CD"</code></td>
<td align="center"><code>qx</code></td>
<td align="center"><span class="math display">\[a_0 = \begin{cases} 0.05 + 3 q_0 &amp; 0 \le m_0 &lt; 0.1 \\ 0.35 &amp;  q_0 \ge 0.1 \end{cases}\]</span></td>
</tr>
<tr class="odd">
<td align="left"><code>infant</code></td>
<td align="left">Male</td>
<td align="left"><code>"CD"</code></td>
<td align="center"><code>mx</code></td>
<td align="center"><span class="math display">\[a_0 = \begin{cases} 0.045 + 2.684 m_0 &amp; 0 \le m_0 &lt; 0.107 \\ b0.33 &amp;  m_0 \ge 0.107 \end{cases}\]</span></td>
</tr>
<tr class="even">
<td align="left"><code>infant</code></td>
<td align="left">Male</td>
<td align="left"><code>"CD"</code></td>
<td align="center"><code>qx</code></td>
<td align="center"><span class="math display">\[a_0 = \begin{cases} 0.0425 + 2.875 q_0 &amp; 0 \le q_0 &lt; 0.1 \\ 0.33 &amp;     q_0 \ge 0.1 \end{cases}\]</span></td>
</tr>
<tr class="odd">
<td align="left"><code>infant</code></td>
<td align="left">Female</td>
<td align="left"><code>"AK"</code></td>
<td align="center"><code>mx</code></td>
<td align="center"><span class="math display">\[a_0 = \begin{cases} 0.14903 - 2.05527 m_0 &amp; 0 \le m_0 &lt; 0.01724 \\ 0.04667 + 3.88089 m_0 &amp; 0.01724 \le m_0 &lt; 0.06891 \\ 0.31411 &amp;  m_0 \ge 0.06891 \end{cases}\]</span></td>
</tr>
<tr class="even">
<td align="left"><code>infant</code></td>
<td align="left">Female</td>
<td align="left"><code>"AK"</code></td>
<td align="center"><code>qx</code></td>
<td align="center"><span class="math display">\[a_0 = \begin{cases} 0.149 - 2.0867 q_0 &amp; 0 \le q_0 &lt; 0.017 \\ 0.0438 + 4.1075 q_0 &amp; 0.017 \le q_0 &lt; 0.0658 \\ 0.3141 &amp;  q_0 \ge 0.0658 \end{cases}\]</span></td>
</tr>
<tr class="odd">
<td align="left"><code>infant</code></td>
<td align="left">Male</td>
<td align="left"><code>"AK"</code></td>
<td align="center"><code>mx</code></td>
<td align="center"><span class="math display">\[a_0 = \begin{cases} 0.14929 - 1.99545 m_0 &amp; 0 \le m_0 &lt;  0.023 \\ 0.02832 + 3.26021 m_0 &amp;  0.023 \le m_0 &lt; 0.08307 \\ 0.29915 &amp;  m_0 \ge 0.08307 \end{cases}\]</span></td>
</tr>
<tr class="even">
<td align="left"><code>infant</code></td>
<td align="left">Male</td>
<td align="left"><code>"AK"</code></td>
<td align="center"><code>qx</code></td>
<td align="center"><span class="math display">\[a_0 = \begin{cases} 0.1493 - 2.0367 q_0 &amp; 0 \le q_0 &lt;  0.0226 \\ 0.0244 + 3.4994 q_0 &amp;  0.0226 \le q_0 &lt; 0.0785 \\ 0.2991 &amp;  q_0 \ge 0.0785 \end{cases}\]</span></td>
</tr>
<tr class="odd">
<td align="left"><code>child</code></td>
<td align="left">&lt;any&gt;</td>
<td align="left"><code>"constant"</code></td>
<td align="center"><code>mx</code></td>
<td align="center"><span class="math display">\[_4a_1 = \frac{1 - (4 \times {_4}m_1 + 1) e^{-4 \times {_4}m_1}}{_4m_1 (1 - e^{-4 \times {_4}m_1})}\]</span></td>
</tr>
<tr class="even">
<td align="left"><code>child</code></td>
<td align="left">&lt;any&gt;</td>
<td align="left"><code>"constant"</code></td>
<td align="center"><code>qx</code></td>
<td align="center"><span class="math display">\[_4a_1 = \frac{4((1 - \log(1-{_4}q_1)) (1 - {_4}m_1) - 1)}{\log(1 - {_4q_1}) {_4}q_1}\]</span></td>
</tr>
<tr class="odd">
<td align="left"><code>child</code></td>
<td align="left">&lt;any&gt;</td>
<td align="left"><code>"linear"</code></td>
<td align="center"><code>mx</code></td>
<td align="center"><span class="math display">\[_4a_1 = 2\]</span></td>
</tr>
<tr class="even">
<td align="left"><code>child</code></td>
<td align="left">&lt;any&gt;</td>
<td align="left"><code>"linear"</code></td>
<td align="center"><code>qx</code></td>
<td align="center"><span class="math display">\[_4a_1 = 2\]</span></td>
</tr>
<tr class="odd">
<td align="left"><code>child</code></td>
<td align="left">Female</td>
<td align="left"><code>"CD"</code></td>
<td align="center"><code>mx</code></td>
<td align="center"><span class="math display">\[_4a_1 = \begin{cases} 1.522 - 1.518 m_0 &amp; 0 \le m_0 &lt; 0.107 \\ 1.361 &amp;  m_0 \ge 0.107 \end{cases}\]</span></td>
</tr>
<tr class="even">
<td align="left"><code>child</code></td>
<td align="left">Female</td>
<td align="left"><code>"CD"</code></td>
<td align="center"><code>qx</code></td>
<td align="center"><span class="math display">\[_4a_1 = \begin{cases} 1.542 - 1.625 q_0 &amp; 0 \le q_0 &lt; 0.1 \\ 1.361 &amp;  q_0 \ge 0.1 \end{cases}\]</span></td>
</tr>
<tr class="odd">
<td align="left"><code>child</code></td>
<td align="left">Male</td>
<td align="left"><code>"CD"</code></td>
<td align="center"><code>mx</code></td>
<td align="center"><span class="math display">\[_4a_1 = \begin{cases} 1.651 - 2.816 m_0 &amp; 0 \le m_0 &lt; 0.107 \\ 1.352 &amp;  m_0 \ge 0.107 \end{cases}\]</span></td>
</tr>
<tr class="even">
<td align="left"><code>child</code></td>
<td align="left">Male</td>
<td align="left"><code>"CD"</code></td>
<td align="center"><code>qx</code></td>
<td align="center"><span class="math display">\[_4a_1 = \begin{cases} 1.653 - 3.013 q_0 &amp; 0 \le q_0 &lt; 0.1 \\ 1.352 &amp;  q_0 \ge 0.1 \end{cases}\]</span></td>
</tr>
<tr class="odd">
<td align="left"><code>closed</code></td>
<td align="left">&lt;any&gt;</td>
<td align="left"><code>"constant"</code></td>
<td align="center"><code>mx</code></td>
<td align="center"><span class="math display">\[_na_x = \frac{1 - (n \times {_n}m_x + 1) e^{-n \times {_n}m_x}}{_nm_x (1 - e^{-n \times {_n}m_x})}\]</span></td>
</tr>
<tr class="even">
<td align="left"><code>closed</code></td>
<td align="left">&lt;any&gt;</td>
<td align="left"><code>"constant"</code></td>
<td align="center"><code>qx</code></td>
<td align="center"><span class="math display">\[_na_x = \frac{n((1 - \log(1 - {_n}q_x))(1 - {_nq_x}) - 1)}{\log(1 - {_nq_x}) {_n}q_x}\]</span></td>
</tr>
<tr class="odd">
<td align="left"><code>closed</code></td>
<td align="left">&lt;any&gt;</td>
<td align="left"><code>"linear"</code></td>
<td align="center"><code>mx</code></td>
<td align="center"><span class="math display">\[_na_x = 0.5 n\]</span></td>
</tr>
<tr class="even">
<td align="left"><code>closed</code></td>
<td align="left">&lt;any&gt;</td>
<td align="left"><code>"linear"</code></td>
<td align="center"><code>qx</code></td>
<td align="center"><span class="math display">\[_na_x = 0.5 n\]</span></td>
</tr>
<tr class="odd">
<td align="left"><code>open</code></td>
<td align="left">&lt;any&gt;</td>
<td align="left"><code>"constant"</code></td>
<td align="center"><code>mx</code></td>
<td align="center"><span class="math display">\[_{\infty}a_{\omega} = \frac{1}{_{\infty}m_{\omega}}\]</span></td>
</tr>
<tr class="even">
<td align="left"><code>open</code></td>
<td align="left">&lt;any&gt;</td>
<td align="left"><code>"constant"</code></td>
<td align="center"><code>qx</code></td>
<td align="center"><span class="math display">\[_{\infty}a_{\omega} = \frac{1}{_{n}m_{\omega-n}}\]</span></td>
</tr>
</tbody>
</table>
<p>In the table above, the values for <code>"CD"</code> are from <span class="citation">Coale, Demeny, and Vaughan (1983)</span>, p20, and <span class="citation">Preston, Heuveline, and Guillot (2001)</span>, p48; the values for <code>"AK"</code> are from <span class="citation">Andreev and Kingkade (2015)</span>, p376, and <span class="citation">Wilmoth et al. (2021)</span>, p37; and the values for <code>"constant"</code> are expected values for an exponential distribution that has been right-truncated at <span class="math inline">\(n\)</span>.</p>
<p>When the inputs data are <span class="math inline">\(_nq_x\)</span>, the value of <span class="math inline">\(_na_x\)</span> for the last age group is based in mortality rates in the second-to-last age group. This is an expedient to deal with the fact that <span class="math inline">\(_nq_x\)</span> is always 1 in the last age group, and therefore provides no information about mortality conditions in that age group.</p>
<p>Once the <span class="math inline">\(_na_x\)</span> have been determined, the life table is fully specified, and the required calculations can be carried out with no further input from the user.</p>
<p>The probability of dying within each interval is</p>
<p><span class="math display">\[_nq_x = \frac{n \times {_n}m_x}{1 + (n -  {_n}a_x) \times {_nm_x}},\]</span>
with <span class="math inline">\(_{\infty}q_{\omega} = 1\)</span>. Quantity <span class="math inline">\(l_x\)</span> is the number of people surviving to exact age <span class="math inline">\(x\)</span>. In <code><a href="../reference/lifetab.html">lifetab()</a></code>, by default, <span class="math inline">\(l_0 = 100,000\)</span>. Remaining values are calculated using</p>
<p><span class="math display">\[l_{x+n} = (1 - {_nq_x}) \times l_x.\]</span>
Quantity <span class="math inline">\(_nd_x\)</span> is the number of people who die between exact ages <span class="math inline">\(x\)</span> and <span class="math inline">\(x+n\)</span>,</p>
<p><span class="math display">\[_nd_x = l_x - l_{x+n}.\]</span></p>
<p>Quantity <span class="math inline">\(_nL_x\)</span> is the number of person-years lived between exact ages <span class="math inline">\(x\)</span> and <span class="math inline">\(x+n\)</span>. It consists of person-years lived by people who survive the interval, plus person-years lived by people who die within the interval,</p>
<p><span class="math display">\[_nL_x = l_{x+n} \times n + {_nd_x} \times {_na_x}.\]</span>
Finally, <span class="math inline">\(e_x\)</span>, the number of years of life remaining to a person aged exactly <span class="math inline">\(x\)</span>, is
<span class="math display">\[e_x = {_nL_x} + {_nL_{x+n}} + \cdots + {_{\infty}L_{\omega}}\]</span>.</p>
<p>Although the results for <code><a href="../reference/lifetab.html">lifetab()</a></code> and <code><a href="../reference/lifetab.html">lifeexp()</a></code> do vary with difference choices for <code>infant</code>, <code>child</code>, or <code>closed</code>, the differences are often small,</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lin</span> <span class="op">&lt;-</span> <span class="va">nzmort</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lifetab.html">lifeexp</a></span><span class="op">(</span>mx <span class="op">=</span> <span class="va">mx</span>,</span>
<span>          by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">gender</span>, <span class="va">year</span><span class="op">)</span>,</span>
<span>          infant <span class="op">=</span> <span class="st">"linear"</span>,</span>
<span>          suffix <span class="op">=</span> <span class="st">"lin"</span><span class="op">)</span></span>
<span><span class="va">ak</span> <span class="op">&lt;-</span> <span class="va">nzmort</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lifetab.html">lifeexp</a></span><span class="op">(</span>mx <span class="op">=</span> <span class="va">mx</span>,</span>
<span>          sex <span class="op">=</span> <span class="va">gender</span>,</span>
<span>          by <span class="op">=</span> <span class="va">year</span>,</span>
<span>          infant <span class="op">=</span> <span class="st">"AK"</span>, </span>
<span>          suffix <span class="op">=</span> <span class="st">"ak"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">lin</span>, <span class="va">ak</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"gender"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>diff <span class="op">=</span> <span class="va">ex.lin</span> <span class="op">-</span> <span class="va">ex.ak</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">#&gt;   gender  year ex.lin ex.ak     diff</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Female  <span style="text-decoration: underline;">2</span>021   84.0  84.0 0.000<span style="text-decoration: underline;">906</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Male    <span style="text-decoration: underline;">2</span>021   80.5  80.5 0.001<span style="text-decoration: underline;">10</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Female  <span style="text-decoration: underline;">2</span>022   83.4  83.4 0.000<span style="text-decoration: underline;">771</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Male    <span style="text-decoration: underline;">2</span>022   80.0  80.0 0.000<span style="text-decoration: underline;">965</span></span></span></code></pre></div>
</div>
<div class="section level4" number="2.2.3">
<h4 id="uncertainty">
<span class="header-section-number">2.2.3</span> Uncertainty<a class="anchor" aria-label="anchor" href="#uncertainty"></a>
</h4>
<p>The examples of life tables and life expectancy so far have all been based on a deterministic input, <code>mx</code> column of data frame <code>nzmort</code>,</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nzmort</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 84 × 6</span></span></span>
<span><span class="co">#&gt;     year gender age         deaths   popn        mx</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">2</span>021 Female Infant         108  <span style="text-decoration: underline;">29</span>570 0.003<span style="text-decoration: underline;">65</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">2</span>021 Female 1-4 years       30 <span style="text-decoration: underline;">118</span>950 0.000<span style="text-decoration: underline;">252</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">2</span>021 Female 5-9 years       12 <span style="text-decoration: underline;">158</span>350 0.000<span style="text-decoration: underline;">075</span>8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">2</span>021 Female 10-14 years     21 <span style="text-decoration: underline;">163</span>800 0.000<span style="text-decoration: underline;">128</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>021 Female 15-19 years     51 <span style="text-decoration: underline;">152</span>960 0.000<span style="text-decoration: underline;">333</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>021 Female 20-24 years     54 <span style="text-decoration: underline;">160</span>250 0.000<span style="text-decoration: underline;">337</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>021 Female 25-29 years     60 <span style="text-decoration: underline;">180</span>290 0.000<span style="text-decoration: underline;">333</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>021 Female 30-34 years     63 <span style="text-decoration: underline;">192</span>070 0.000<span style="text-decoration: underline;">328</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>021 Female 35-39 years    105 <span style="text-decoration: underline;">171</span>970 0.000<span style="text-decoration: underline;">611</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>021 Female 40-44 years    153 <span style="text-decoration: underline;">157</span>740 0.000<span style="text-decoration: underline;">970</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 74 more rows</span></span></span></code></pre></div>
<p>The data frame <code>nzmort_rvec</code> instead uses a rvec to represent mortality rates,</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayesiandemography.github.io/rvec/" class="external-link">rvec</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'rvec'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     sd, var</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     rank</span></span>
<span><span class="va">nzmort_rvec</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 84 × 4</span></span></span>
<span><span class="co">#&gt;     year gender age                                 mx</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;rdbl&lt;1000&gt;&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">2</span>021 Female Infant         0.0032 (0.0028, 0.0037)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">2</span>021 Female 1-4 years   0.00018 (0.00014, 0.00022)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">2</span>021 Female 5-9 years   9.2e-05 (7.3e-05, 0.00012)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">2</span>021 Female 10-14 years 0.00012 (9.9e-05, 0.00014)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>021 Female 15-19 years 0.00027 (0.00023, 0.00031)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>021 Female 20-24 years 0.00032 (0.00028, 0.00036)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>021 Female 25-29 years 0.00034 (0.00031, 0.00038)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>021 Female 30-34 years 0.00042 (0.00038, 0.00046)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>021 Female 35-39 years   6e-04 (0.00054, 0.00065)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>021 Female 40-44 years 0.00091 (0.00084, 0.00098)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 74 more rows</span></span></span></code></pre></div>
<p>The <code>mx</code> rvec holds 1000 draws from the posterior distribution from a Bayesian model of mortality. The posterior distribution for infant mortality for females in 2021, for instance, has a posterior median of 0.0032, and a 95% credible interval of (0.0028, 0.0037).</p>
<p>If the input to <code><a href="../reference/lifetab.html">lifetab()</a></code> or <code><a href="../reference/lifetab.html">lifeexp()</a></code> is an rvec, then the output will be too. Uncertainty about mortality rates is propagated through to quantities derived from these rates.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayesiandemography.github.io/rvec/" class="external-link">rvec</a></span><span class="op">)</span></span>
<span><span class="va">nzmort_rvec</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2022</span>,</span>
<span>         <span class="va">gender</span> <span class="op">==</span> <span class="st">"Female"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/lifetab.html">lifetab</a></span><span class="op">(</span>mx <span class="op">=</span> <span class="va">mx</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">qx</span>, <span class="va">lx</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 21 × 3</span></span></span>
<span><span class="co">#&gt;    age                                 qx                   lx</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;rdbl&lt;1000&gt;&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;rdbl&lt;1000&gt;&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Infant         0.0034 (0.0029, 0.0039) 1e+05 (1e+05, 1e+05)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1-4 years     0.00075 (6e-04, 0.00095) 99661 (99613, 99708)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 5-9 years     5e-04 (0.00039, 0.00063) 99587 (99534, 99638)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 10-14 years 0.00064 (0.00053, 0.00076) 99538 (99479, 99594)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 15-19 years    0.0014 (0.0012, 0.0016) 99474 (99411, 99532)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 20-24 years    0.0017 (0.0015, 0.0019) 99332 (99265, 99393)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 25-29 years    0.0018 (0.0017, 0.0021) 99163 (99093, 99231)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 30-34 years    0.0023 (0.0021, 0.0025) 98979 (98901, 99053)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 35-39 years    0.0032 (0.0029, 0.0035) 98753 (98666, 98837)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 40-44 years    0.0048 (0.0044, 0.0052) 98438 (98339, 98530)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 11 more rows</span></span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2" number="3">
<h2 id="tools-for-developers">
<span class="header-section-number">3</span> Tools for developers<a class="anchor" aria-label="anchor" href="#tools-for-developers"></a>
</h2>
<p><strong>poputils</strong> provides some functions that developers creating packages to be used by demographers may find useful.</p>
<div class="section level3" number="3.1">
<h3 id="labels-1">
<span class="header-section-number">3.1</span> Labels<a class="anchor" aria-label="anchor" href="#labels-1"></a>
</h3>
<p><code><a href="../reference/check_age.html">check_age()</a></code> and <code><a href="../reference/age_group_type.html">age_group_type()</a></code> can be useful in functions that involve age group labels. <code><a href="../reference/check_age.html">check_age()</a></code> performs some basic validity checks, while <code><a href="../reference/age_group_type.html">age_group_type()</a></code> assesses whether a set of labels belongs to type <code>"single"</code>, <code>"five"</code>, or <code>"lt"</code>.</p>
<p>It is often possible to guess the nature of a demographic variable, or of categories within a demographic variable, based on names and labels. Functions <code><a href="../reference/find_var_age.html">find_var_age()</a></code>, <code><a href="../reference/find_var_sexgender.html">find_var_sexgender()</a></code>, <code><a href="../reference/find_var_time.html">find_var_time()</a></code>, <code><a href="../reference/find_label_female.html">find_label_female()</a></code>, and <code><a href="../reference/find_label_male.html">find_label_male()</a></code> help with these sorts of inferences.</p>
</div>
<div class="section level3" number="3.2">
<h3 id="data-manipulation">
<span class="header-section-number">3.2</span> Data manipulation<a class="anchor" aria-label="anchor" href="#data-manipulation"></a>
</h3>
<p>Function <code><a href="../reference/groups_colnums.html">groups_colnums()</a></code> is helpful when implementing <a href="https://tidyselect.r-lib.org/reference/language.html" class="external-link">tidyselect</a> methods when the data are held in a grouped data frame.</p>
<p><code><a href="../reference/matrix_to_list_of_cols.html">matrix_to_list_of_cols()</a></code> and <code><a href="../reference/matrix_to_list_of_cols.html">matrix_to_list_of_rows()</a></code> convert from matrices to lists of vectors.</p>
<p><code><a href="../reference/to_matrix.html">to_matrix()</a></code> converts a data frame to a matrix. The data frame potentially has more than two classification variables, and the rows and/or columns of the matrix can be formed from combinations of these variables.</p>
</div>
</div>
<div class="section level2" number="4">
<h2 id="future-developments">
<span class="header-section-number">4</span> Future developments<a class="anchor" aria-label="anchor" href="#future-developments"></a>
</h2>
<div class="section level3" number="4.1">
<h3 id="definite">
<span class="header-section-number">4.1</span> Definite<a class="anchor" aria-label="anchor" href="#definite"></a>
</h3>
<ul>
<li>
<strong>Stable populations</strong>. Given mortality and fertility profiles, generate the associated stable population.</li>
<li>
<strong>Time labels</strong> Functions for dealing with time labels analogous to the existing ones dealing with age labels. The functions need to allow for one-month and one-quarter periods, and for ‘exact times’, ie dates.</li>
<li>
<strong>Multiple decrement life tables</strong> Extend <code><a href="../reference/lifetab.html">lifetab()</a></code> and <code><a href="../reference/lifetab.html">lifeexp()</a></code> to allow for multiple decrements.</li>
<li>
<strong>Projection accounting</strong> Functions to turn projected demographic rates, and an initial population, into a projected demographic account. Needs flexibility over dimensions included, and needs deterministic and probabilistic versions.</li>
<li>
<strong>TFR</strong> Function to calculation total fertility rates from age-specific fertility rates</li>
<li>
<strong>Age, period, cohort labels</strong> Functions to allocate events to age groups, periods, or cohorts, based on data on dates of event and dates of birth.</li>
</ul>
</div>
<div class="section level3" number="4.2">
<h3 id="possible">
<span class="header-section-number">4.2</span> Possible<a class="anchor" aria-label="anchor" href="#possible"></a>
</h3>
<ul>
<li>
<strong>Aggregation function</strong> Using <code><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">dplyr::count()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">dplyr::summarise()</a></code>, or <code><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">stats::aggregate()</a></code> to aggregate counts or rates in a data frame is awkward. Given that this is such a common operation, it might be worthwhile to do a replacement.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-andreev2015average" class="csl-entry">
Andreev, Evgeny M, and W Ward Kingkade. 2015. <span>“Average Age at Death in Infancy and Infant Mortality Level: Reconsidering the Coale-Demeny Formulas at Current Levels of Low Mortality.”</span> <em>Demographic Research</em> 33: 363–90.
</div>
<div id="ref-coale1983regional" class="csl-entry">
Coale, Ansley J, Paul Demeny, and Barbara Vaughan. 1983. <em>Regional Model Life Tables and Stable Populations: Studies in Population</em>. Academic Press.
</div>
<div id="ref-keyfitz2005applied" class="csl-entry">
Keyfitz, Nathan, and Hal Caswell. 2005. <em>Applied Mathematical Demography</em>. Springer.
</div>
<div id="ref-preston2001demography" class="csl-entry">
Preston, Samuel H., Patrick Heuveline, and Michel Guillot. 2001. <em>Demography: Measuring and Modeling Population Processes</em>. Blackwell.
</div>
<div id="ref-wilmoth2021methods" class="csl-entry">
Wilmoth, John R, Kirill Andreev, Dmitri Jdanov, Dana A Glei, and Tim Riffe. 2021. <span>“Methods Protocol for the Human Mortality Database. Version 6.”</span>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by John Bryant.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
